@page "/FinalizarEntrega/{id:int}"
@inject HttpClient Http
@inject IJSRuntime JS

<body onbeforeunload="DataTableRemove()">
    <h3>Finalizar Entrega</h3>
    <div class="container">
        <div class="card">
            <div class="card-body">
                <h2 class="card-title text-center">Entrega</h2>
                <div class="row">
                    <div class="col-sm-6">
                        <p class="card-text">id: @entrega.id</p>
                        <p class="card-text">Conductor: @entrega.chofer</p>
                        <p class="card-text">Vehiculo: @entrega.vehiculo</p>
                    </div>
                    <div class="col-sm-6">
                        <p class="card-text">Peso: @entrega.peso</p>
                        <p class="card-text">Costo: @entrega.costo</p>
                        <p class="card-text">Fecha de Salida: @entrega.fechaSalida.ToString("dd-MM-yyyy")</p>
                    </div>
                </div>
                <p class="card-text">comentarios: @entrega.comentarios</p>
            </div>
        </div>
    </div>

    @if (facturas == null)
    {
        <text> Cargando... </text>
    }
    else if (facturas.Count == 0)
    {
        <text> No hay facturas asignadas a la entrega </text>
    }
    else
    {
<div align="center">
    <div class="container">
        <div class="card">
            <div class="card-body">
                <h2 class="card-title">Facturas</h2>
                <table id="datatable" align="center" class="table table-responsive-sm table-striped table-bordered text-center" style="width:100%">
                    <thead>
                        <tr>
                            <td>id</td>
                            <td>Peso Total</td>
                            <td>Forma de Cobro</td>
                            <td>Moneda</td>
                            <td>Monto Total</td>
                            <td>Cliente</td>
                            <td>Ubicación</td>
                            <td>Dirección</td>
                            <td>Comentarios</td>
                        </tr>
                    </thead>
                    <tbody>
                        @foreach (var factura in facturas)
                        {
                            <tr>
                                <td>@factura.id</td>
                                <td>@factura.pesoTotal</td>
                                <td>@factura.formaCobro</td>
                                <td>@factura.moneda</td>
                                <td>@factura.montoTotal</td>
                                <td>@factura.nombreCliente</td>
                                <td>@factura.ubicacion</td>
                                <td>@factura.direccion</td>
                                <td>@factura.comentarios</td>
                            </tr>
                        }
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
            }
<div class="container">
    <EditForm Model="@entrega" OnValidSubmit="@finalizarEntrega">
        <div class="card card-body">
            <div class="row">
                <div class="col-lg-6">
                    <div>
                        <a style="color:red">*</a>
                        <label> Ingrese el kilometraje de Salida: </label>
                        <InputNumber @bind-Value="@entrega.kilometrajeSalida" />
                    </div>

                    <div>
                        <a style="color:red">*</a>
                        <label> Ingrese la fecha de Llegada: </label>
                        <InputDate @bind-Value="@entrega.fechaLlegada" />
                    </div>
                </div>
                <div class="col-lg-6">
                    <div>
                        <a style="color:red">*</a>
                        <label> Ingrese el kilometraje de Llegada: </label>
                        <InputNumber @bind-Value="@entrega.kilometrajeLlegada" />
                    </div>

                    <div>
                        <a style="color:red">*</a>
                        <label> Ingrese el costo operativo de la entrega: </label>
                        <InputNumber @bind-Value="@entrega.costoOperativo" />
                    </div>
                </div>
            </div>

            <div>
                <a style="color:red">*</a>
                <label> Se recargó el combustible en la entrega: </label>
                <InputCheckbox @bind-Value="@entrega.recargaCombustible" />
            </div>

            <div>
                <label> Comentarios de Llegada: </label>
                <InputTextArea @bind-Value="@entrega.comentariosLlegada" />
            </div>

            <div align="center">
                <button type="submit" class="btn btn-success">Finalizar Entrega</button>
                <a class=" btn btn-danger" href="Entregas">
                    Cancelar
                </a>
            </div>
        </div>
    </EditForm>
</div>
</body>



@code {
    [Parameter] public int id { get; set; }
    Entrega entrega = new Entrega();
    public List<Factura> facturas { get; set; }

    protected async override Task OnParametersSetAsync()
    {
        entrega = await Http.GetJsonAsync<Entrega>($"Entrega/{id}");
        facturas = await Http.GetJsonAsync<List<Factura>>($"Entregas/{id}");
        await JS.InvokeAsync<object>("DataTableAdd");
    }

    async Task finalizarEntrega()
    {

    }
}
